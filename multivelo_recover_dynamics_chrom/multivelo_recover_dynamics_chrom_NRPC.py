import os
import numpy as np
import pandas as pd
import scanpy as sc
import scvelo as scv
import multivelo as mv
import sys
import matplotlib.pyplot as plt

pd.options.display.max_columns = None
scv.set_figure_params(dpi=600, dpi_save=600)

adata_rna_file = "/storage/singlecell/zz4/fetal_bash/results/multivelo_recover_dynamics_run_umap_NRPC/adata_umap.h5ad"
adata_atac_file = (
    "/storage/singlecell/zz4/fetal_bash/results/multivelo_knn_smooth_chrom/NRPC.h5ad"
)
output_file = "/storage/singlecell/zz4/fetal_bash/results/multivelo_recover_dynamics_results/NRPC.h5ad"

adata_rna = scv.read(adata_rna_file)


genes = [
    "AR",
    "ARID5B",
    "ARNTL2",
    "ASCL1",
    "ATOH7",
    "BACH1",
    "BACH2",
    "BARHL2",
    "BCL11A",
    "BCL11B",
    "CCDC88A",
    "CDC5L",
    "CPEB1",
    "CREB5",
    "CRX",
    "CTCF",
    "CUX2",
    "DACH1",
    "DACH2",
    "DLX1",
    "DLX2",
    "DMBX1",
    "E2F1",
    "E2F2",
    "E2F3",
    "E2F5",
    "E2F7",
    "E2F8",
    "EBF1",
    "EBF2",
    "EBF3",
    "EGR1",
    "ELF2",
    "EPAS1",
    "ESR2",
    "ESRRB",
    "ESRRG",
    "ETV1",
    "ETV5",
    "FEZF2",
    "FOS",
    "FOXB1",
    "FOXM1",
    "FOXN3",
    "FOXN4",
    "FOXO1",
    "FOXO3",
    "FOXO6",
    "FOXP1",
    "FOXP2",
    "FOXP4",
    "FOXQ1",
    "GABPB1",
    "GATA2",
    "GLI2",
    "GLI3",
    "GLIS3",
    "HES1",
    "HES2",
    "HES4",
    "HES5",
    "HES6",
    "HEY1",
    "HEY2",
    "HEYL",
    "HIF1A",
    "HIF3A",
    "HIVEP1",
    "HIVEP2",
    "HIVEP3",
    "HLF",
    "HMBOX1",
    "HMGA1",
    "HMGA2",
    "HMGB1",
    "HMGB2",
    "HMGB3",
    "HMGXB4",
    "HMX1",
    "HOPX",
    "ID2",
    "ID3",
    "ID4",
    "IKZF2",
    "INSM1",
    "INSM2",
    "IRX5",
    "IRX6",
    "ISL1",
    "ISL2",
    "JAZF1",
    "JUN",
    "JUNB",
    "KLF13",
    "KLF6",
    "KLF7",
    "LCORL",
    "LEF1",
    "LHX1",
    "LHX2",
    "LHX3",
    "LHX4",
    "LHX9",
    "LIN28B",
    "LYL1",
    "MAEL",
    "MAF",
    "MAZ",
    "MECOM",
    "MEF2C",
    "MEIS1",
    "MEIS2",
    "MESP2",
    "MITF",
    "MLLT10",
    "MLXIP",
    "MTA3",
    "MXD3",
    "MXI1",
    "MYB",
    "MYBL1",
    "MYBL2",
    "MYT1L",
    "NCOA1",
    "NEUROD1",
    "NEUROD4",
    "NEUROG1",
    "NEUROG2",
    "NFATC2",
    "NFATC3",
    "NFIA",
    "NFIB",
    "NFIC",
    "NFIX",
    "NHLH1",
    "NHLH2",
    "NKX6-1",
    "NPAS2",
    "NPAS3",
    "NR2E1",
    "NR2E3",
    "NR2F1",
    "NR2F2",
    "NR3C1",
    "NR3C2",
    "NR4A1",
    "NR4A2",
    "NR4A3",
    "NR6A1",
    "NRF1",
    "NRL",
    "NSD2",
    "OLIG2",
    "ONECUT1",
    "ONECUT2",
    "ONECUT3",
    "OTX2",
    "OVOL2",
    "PAX6",
    "PBX1",
    "PBX3",
    "PBX4",
    "PKNOX2",
    "PLAG1",
    "PLAGL1",
    "POU2F1",
    "POU2F2",
    "POU3F1",
    "POU4F2",
    "POU6F2",
    "PRDM1",
    "PRDM13",
    "PRDM5",
    "PRDM6",
    "PRDM8",
    "PROX1",
    "PTF1A",
    "RARB",
    "RAX",
    "RAX2",
    "RBPJ",
    "REST",
    "RFX2",
    "RORA",
    "RORB",
    "RREB1",
    "RUNX1",
    "RXRG",
    "SALL3",
    "SCRT1",
    "SCRT2",
    "SHOX2",
    "SKOR2",
    "SMAD2",
    "SMAD3",
    "SMAD6",
    "SMAD7",
    "SMAD9",
    "SOX11",
    "SOX13",
    "SOX2",
    "SOX4",
    "SOX5",
    "SOX6",
    "SOX8",
    "SOX9",
    "SP3",
    "SP8",
    "SREBF2",
    "ST18",
    "STAT3",
    "TBX20",
    "TBX3",
    "TBX5",
    "TCF12",
    "TCF4",
    "TCF7L1",
    "TCF7L2",
    "TEAD1",
    "TEAD4",
    "TFAP2A",
    "TFAP2B",
    "TFAP2C",
    "TFAP2D",
    "TFDP1",
    "TFDP2",
    "TGIF1",
    "THRB",
    "TOX",
    "TOX2",
    "TOX3",
    "TP73",
    "TRERF1",
    "TRPS1",
    "TSHZ2",
    "TSHZ3",
    "VAX2",
    "VSX1",
    "VSX2",
    "YBX1",
    "ZBTB16",
    "ZBTB18",
    "ZBTB20",
    "ZBTB7A",
    "ZBTB7C",
    "ZEB1",
    "ZEB2",
    "ZFHX3",
    "ZFP90",
    "ZFP91",
    "ZFPM2",
    "ZHX1",
    "ZIC1",
    "ZIC2",
    "ZIC5",
    "ZNF100",
    "ZNF107",
    "ZNF117",
    "ZNF253",
    "ZNF254",
    "ZNF257",
    "ZNF292",
    "ZNF331",
    "ZNF367",
    "ZNF385D",
    "ZNF423",
    "ZNF462",
    "ZNF483",
    "ZNF486",
    "ZNF492",
    "ZNF516",
    "ZNF519",
    "ZNF521",
    "ZNF536",
    "ZNF569",
    "ZNF66",
    "ZNF680",
    "ZNF682",
    "ZNF695",
    "ZNF704",
    "ZNF714",
    "ZNF718",
    "ZNF724",
    "ZNF726",
    "ZNF730",
    "ZNF732",
    "ZNF821",
    "ZNF827",
    "ZNF83",
    "ZNF85",
    "ZNF850",
    "ZNF90",
    "ZNF93",
    "AHR",
    "BBX",
    "CTCFL",
    "DPF1",
    "DRGX",
    "EVX2",
    "FEZF1",
    "FOXK2",
    "HIC1",
    "HMX3",
    "IRX4",
    "KLF9",
    "NFAT5",
    "NR2C2",
    "PPARA",
    "SAMD11",
    "SP9",
    "SSRP1",
    "TAL2",
    "TCF3",
    "TFAP2E",
    "TP63",
    "UBTF",
    "ZBTB38",
    "ZNF22",
    "ZNF438",
    "ZNF618",
    "HDX",
    "CUX1",
    "RCOR2",
    "TADA2A",
    "TBX2",
    "UNCX",
    "ZNF276",
    "ZNF518A",
    "ARID3A",
    "ZHX3",
    "EOMES",
    "FIGLA",
    "FOXJ1",
    "MYOG",
    "NFE2",
    "OTP",
    "PAX2",
    "PPARG",
    "TFEC",
    "ZNF467",
    "FOSL1",
    "SALL4",
    "WT1",
    "BARX2",
    "DDIT3",
    "HOXA1",
    "ID1",
    "LMX1A",
    "MEF2A",
    "PAX5",
    "POU6F1",
    "RFX3",
    "RFX4",
    "RXRA",
    "SATB1",
    "SNAI1",
    "SOX1",
    "SP5",
    "TGIF2",
    "ZFHX2",
    "ZNF296",
    "ZNF30",
    "ZNF33B",
    "ZNF648",
    "ZBTB8A",
    "ALX1",
    "ARID5A",
    "ASCL5",
    "BHLHE22",
    "BNC2",
    "CEBPB",
    "CEBPG",
    "EHF",
    "ETS2",
    "FOSB",
    "FOXC1",
    "HMG20B",
    "HNF4A",
    "HOXA3",
    "IKZF3",
    "JDP2",
    "KLF5",
    "MAFK",
    "MEOX2",
    "MESP1",
    "NEUROD2",
    "NEUROD6",
    "NFKB2",
    "NKX1-1",
    "NR5A2",
    "OVOL3",
    "PGR",
    "PHOX2B",
    "POU3F3",
    "POU4F3",
    "PRDM16",
    "RUNX3",
    "SALL1",
    "SOX3",
    "TBR1",
    "TBX10",
    "TBX21",
    "TCF23",
    "THAP1",
    "ZBTB10",
    "ZFP42",
    "ZNF221",
    "ZNF319",
    "ZNF534",
    "ZNF768",
    "ZNF816",
    "ZNF878",
    "BHLHE40",
    "ELF4",
    "DMRTA2",
    "ETV3L",
    "KLF2",
    "MKX",
    "MYCL",
    "NFE2L3",
    "OSR2",
    "OTX1",
    "PKNOX1",
    "PROP1",
    "SIX6",
    "SP6",
    "SPIB",
    "VDR",
    "ZNF503",
    "ZNF540",
    "ZNF572",
    "GRB10",
    "ABI3BP",
    "C21orf58",
    "CADM1",
    "CENPK",
    "CGNL1",
    "CLSPN",
    "DNA2",
    "EZH2",
    "GRIA1",
    "MIS18BP1",
    "NUSAP1",
    "PAG1",
    "SORBS2",
    "SPOCK1",
    "TNIK",
    "WIF1",
    "ATAD2",
    "BRCA1",
    "KIF15",
    "RRM2",
    "ADGRB3",
    "APOLD1",
    "AURKB",
    "BUB1B",
    "CADPS",
    "CDC25C",
    "CDCA3",
    "CENPE",
    "CENPF",
    "CIT",
    "CKAP2L",
    "DLGAP5",
    "ECT2",
    "FAM155A",
    "KIF11",
    "KIF14",
    "KIF18B",
    "KIFC1",
    "KNL1",
    "MIAT",
    "MKI67",
    "NAV2",
    "NCAPG",
    "NCAPG2",
    "NRXN3",
    "PBK",
    "RGS16",
    "RHBDL3",
    "RTKN2",
    "TOP2A",
    "TPX2",
    "TUBA1B",
    "ABLIM3",
    "ANK1",
    "APBB2",
    "ARHGAP32",
    "ASPH",
    "CACNA1A",
    "CBFA2T2",
    "CCDC60",
    "CHRNA3",
    "CPLX2",
    "DCC",
    "DLL3",
    "DLL4",
    "ELAVL3",
    "EYA2",
    "FSTL4",
    "GABBR2",
    "GADD45A",
    "GFRA1",
    "GRIK3",
    "GSG1L",
    "IGFBPL1",
    "KCNK3",
    "LOXL1",
    "LRRC4C",
    "MDGA1",
    "MIR217HG",
    "MYO16",
    "PARD3B",
    "PCBP4",
    "PEX5L",
    "RASD1",
    "RELN",
    "RMST",
    "SLC35F1",
    "STK39",
    "TMEM108",
    "TRPM3",
    "WDR72",
    "GRIK1",
    "IQCJ-SCHIP1",
    "EPB41L2",
    "KLHDC8A",
    "LINC00511",
    "NRG1",
    "NTM",
    "CACNG5",
    "CAMK4",
    "CELF4",
    "CEP112",
    "CNTNAP2",
    "CPNE4",
    "CSMD1",
    "DGKI",
    "DOCK4",
    "DPF3",
    "ENOX1",
    "FSTL5",
    "JARID2",
    "MEGF11",
    "NEBL",
    "NTRK1",
    "NWD2",
    "PDE4B",
    "PDE4D",
    "PKHD1",
    "PLXNA2",
    "PPP1R14C",
    "PRMT8",
    "RAP1GAP2",
    "RBFOX3",
    "RIMS2",
    "RUNX1T1",
    "RYR2",
    "RYR3",
    "SLC24A3",
    "SLIT2",
    "SNTG2",
    "TENM2",
    "TNR",
    "C1orf61",
    "EFNA5",
    "FLT1",
    "GABRG3",
    "GRIA2",
    "HECW1",
    "HKDC1",
    "NTRK2",
    "PTPRD",
    "SYN3",
    "TF",
    "XKR4",
    "ADD2",
    "APBA2",
    "ARHGEF4",
    "CACNA1B",
    "CCNG2",
    "CTNNA2",
    "DNM1",
    "DPP6",
    "EDIL3",
    "IFFO2",
    "KCNB2",
    "KCNQ3",
    "KCTD16",
    "NPHS1",
    "NRXN1",
    "OCA2",
    "PCBP3",
    "PHACTR3",
    "PHC2",
    "PPP1R16B",
    "SETBP1",
    "SFRP2",
    "SHANK2",
    "SLCO5A1",
    "SMPD3",
    "SPATS2L",
    "THBS3",
    "UNC79",
    "ZNF804A",
    "AGBL4",
    "COL25A1",
    "FAP",
    "FIGN",
    "GRID2",
    "KIAA1217",
    "KIRREL3",
    "PCDH7",
    "PTPRM",
    "RALYL",
    "SRGAP1",
    "UTRN",
    "WNT5B",
    "ARHGEF3",
    "CDH23",
    "CDON",
    "COBL",
    "DGKB",
    "DIAPH3",
    "DST",
    "FRMD5",
    "GPC6",
    "KAZN",
    "MARCH1",
    "MTUS2",
    "NPVF",
    "PLEKHG1",
    "RASGRP1",
    "RCVRN",
    "RLBP1",
    "RP1",
    "SCARB1",
    "SEL1L3",
    "SSX2IP",
    "TENM3",
    "VIPR2",
    "ABCA4",
    "AGAP1",
    "AIPL1",
    "ALK",
    "AMER2",
    "ANKRD33B",
    "ANO2",
    "ATP1A3",
    "ATP8A2",
    "CA10",
    "CABP5",
    "CACNA2D4",
    "CHRNB4",
    "CNGB1",
    "CNTN5",
    "DCT",
    "DOCK8",
    "DSCAML1",
    "EGFLAM",
    "EPS8",
    "EYS",
    "FMN1",
    "GABRB3",
    "GNB3",
    "GRM6",
    "IGSF21",
    "IQSEC1",
    "KCNMA1",
    "LINC00599",
    "MAP7",
    "MPP4",
    "MYO5B",
    "NLK",
    "OTX2-AS1",
    "PDC",
    "PLA2G4C",
    "PLXDC1",
    "PRICKLE2",
    "RASGEF1C",
    "RASGRF2",
    "ROM1",
    "RPGRIP1",
    "SLC1A2",
    "SLC1A7",
    "SLC35F3",
    "SLC6A17",
    "SNAP25",
    "SRRM3",
    "SRRM4",
    "SV2B",
    "TMEM132B",
    "TMEM244",
    "USH2A",
    "ZNF385B",
    "ASPM",
    "ESCO2",
    "MELK",
    "PRC1",
    "RACGAP1",
    "CPA6",
    "CRYAB",
    "MEG8",
    "ROBO2",
    "AKAP6",
    "ANLN",
    "CENPU",
    "KALRN",
    "KIF24",
    "LINC01572",
    "SASH1",
    "SLC1A3",
    "TRPM1",
    "CDCA2",
    "ADARB2",
    "AFF3",
    "CACNG3",
    "CNTN2",
    "CNTN4",
    "COL23A1",
    "KCNIP1",
    "KIRREL2",
    "LINC00298",
    "MAPT",
    "NEDD4L",
    "NOL4",
    "PAK5",
    "PRKCB",
    "SLIT1",
    "NOTUM",
    "STMN2",
    "ALDH1A2",
    "NETO1",
    "MSH5",
    "CPAMD8",
    "MPPED2",
    "PCSK2",
    "PIF1",
    "ADGRV1",
    "EGF",
    "SERPINI2",
    "GABRR2",
    "FLI1",
    "CCSER1",
    "LRRTM4",
    "PTPRT",
    "ADGRL2",
    "ERBB4",
    "GPX3",
    "MIR100HG",
    "NAV3",
    "PTN",
    "SAMD5",
    "SHROOM3",
    "UHRF1",
    "ASF1B",
    "CPEB4",
    "CRYM",
    "DNER",
    "HMMR",
    "LMNB1",
    "LSAMP",
    "MOXD1",
    "PDZRN3",
    "POC1A",
    "RGS3",
    "TACC3",
    "TMPO",
    "ZFHX4",
    "ADAMTS6",
    "BTBD17",
    "FAM131C",
    "KIAA1755",
    "MAML3",
    "PDIA5",
    "KDR",
    "MDK",
    "NCKAP5",
    "P3H2",
    "PRKCA",
    "RSPO2",
    "ERC2",
    "NMNAT2",
    "NRG2",
    "OPCML",
    "PCDH9",
    "PLCL1",
    "ANKS1B",
    "ASIC2",
    "CACNG2",
    "FAM171A1",
    "PHACTR1",
    "ARHGEF28",
    "CLU",
    "DCLK1",
    "ELL2",
    "F3",
    "FRMD4A",
    "MAPK4",
    "MCAM",
    "NCALD",
    "OSBPL10",
    "PLCE1",
    "SLC15A3",
    "TSC22D1",
    "ADAM19",
    "ARHGAP24",
    "ATP6V0D2",
    "CPE",
    "EML5",
    "GADD45G",
    "HS3ST4",
    "NIPAL1",
    "RD3",
    "RTN4RL1",
    "SAMD7",
    "UNC13C",
    "VAV3",
    "AK5",
    "ANK3",
    "CD44",
    "MAML2",
    "SNTG1",
    "SYT1",
    "CDH20",
    "FANCA",
    "PTMA",
    "PTPRN2",
    "SHISA6",
    "SLCO3A1",
    "STIL",
    "TMEM132C",
    "UBE2S",
    "PTPRG",
    "SEMA5A",
    "SEMA5B",
    "TRIM2",
    "KDM5B",
    "NCAPD3",
    "CHAF1A",
    "KIF23",
    "PRR11",
    "SMC4",
    "CLVS1",
    "DLG2",
    "DOK6",
    "PLEKHA6",
    "ABCG1",
    "DDAH1",
    "IER2",
    "PLXDC2",
    "SULF1",
    "DRD2",
    "CDH4",
    "SAMSN1",
    "SPTLC3",
    "ZNF804B",
    "APOE",
    "DOC2B",
    "PTPRJ",
    "AC073316.2",
    "SLC22A8",
    "ATP2B1",
    "FAM135B",
    "LINC00322",
    "IYD",
    "FRMD3",
    "GRM7",
    "KCNH5",
    "PITPNM2",
    "SLC4A10",
    "WFDC1",
    "DSCAM",
    "GRID1",
    "BHLHE23",
    "LINC00601",
    "GRIK2",
    "LINC00461",
    "MOB3B",
    "SPON1",
    "IQSEC3",
    "TSPAN9",
    "USP45",
    "CD9",
    "FAM49A",
    "LINC01619",
    "NAV1",
    "CHL1",
    "PDE10A",
    "TPM3",
    "EGFR",
    "FAM110B",
    "BRIP1",
    "H2AFX",
    "HIST1H1B",
    "SKA3",
    "BTG2",
    "EPHA3",
    "SDK1",
    "IQGAP3",
    "SPC24",
    "MND1",
    "NEMP1",
    "WNK2",
    "AP000439.2",
    "RASGEF1B",
    "TMEM132D",
    "GPR55",
    "C5orf47",
    "ANO9",
    "NPFFR1",
    "PHGR1",
    "HOXA9",
    "MYO10",
    "ATP2B2",
    "LGALS2",
    "AC099552.2",
    "NKX1-2",
    "AC112721.2",
    "RTP5",
    "OXT",
    "AHCYL2",
    "MAPK10",
    "TANC1",
    "THSD7A",
    "XRCC2",
    "DLL1",
    "GRIA4",
    "SMOC1",
    "VSTM2B",
    "CTNND2",
    "EPHA5",
    "HIPK2",
    "ITSN1",
    "KLHL29",
    "NRG3",
    "PRKD1",
    "SLC18A2",
    "ST6GALNAC3",
    "THSD7B",
    "CACNA1C",
    "CSMD2",
    "EOGT",
    "FAM107A",
    "GNAO1",
    "LRP2",
    "MACROD2",
    "MEGF10",
    "PCSK6",
    "PDZD2",
    "PITPNC1",
    "PLPPR1",
    "PLXNA4",
    "PPFIA2",
    "PROM1",
    "GRIN3A",
    "NKAIN2",
    "SYNE1",
    "TTC29",
    "ABLIM1",
    "CERKL",
    "DISC1",
    "EPHB1",
    "KIF26B",
    "LIMCH1",
    "PTPRR",
    "SGIP1",
    "ST5",
    "ABCA1",
    "ARL4D",
    "ATG5",
    "ATP1B2",
    "BBS9",
    "CDHR1",
    "FAM161A",
    "FRMPD1",
    "FRMPD2",
    "GNAT1",
    "GPR160",
    "GRAMD1C",
    "HS3ST3B1",
    "KANK1",
    "KIFC3",
    "LARGE1",
    "LEMD1",
    "MMD2",
    "PNPLA3",
    "PRPH2",
    "PRUNE2",
    "PTPN13",
    "SLC40A1",
    "STX3",
    "TULP1",
    "BUB1",
    "FAT3",
    "GALNT13",
    "RGR",
    "ANK2",
    "ATP8A1",
    "ATXN1",
    "CKAP2",
    "KCNQ5",
    "MCC",
    "TENM4",
    "SESN3",
    "LRP1B",
    "ROBO1",
    "CEP128",
    "MDGA2",
    "NRP1",
    "PLEKHA7",
    "CACNB2",
    "CARMIL1",
    "KCNG4",
    "LRTM1",
    "RAPGEF5",
    "SERINC5",
    "SLC24A4",
    "ST3GAL1",
    "TIAM1",
    "ASTN1",
    "EML4",
    "MAGI2",
    "NHSL1",
    "PPP2R2B",
    "ROR2",
    "GABRR3",
    "CADM2",
    "CNTN1",
    "TUBA1A",
    "SLC22A23",
    "SYNDIG1",
    "SDK2",
    "PIK3R1",
    "TLN2",
    "DAB1",
    "CADPS2",
    "HDAC9",
    "KDM4C",
    "MIR181A1HG",
    "SCN3A",
    "CYP17A1",
    "PCP2",
    "GPC5",
    "ACSL6",
    "MYO9A",
    "CHRM1",
    "SEMA3A",
    "GRAMD1B",
    "RPL3L",
    "TPSG1",
    "LINC01077",
    "LINC01096",
    "C1orf210",
    "LTB",
    "PLA2G4F",
    "AGBL1",
    "MIR4290HG",
    "LINC00261",
    "DIRC3",
    "PDE1A",
    "UBE2H",
    "AJAP1",
    "ATXN7L1",
    "BEST3",
    "CDK6",
    "CHEK1",
    "CLIP4",
    "HJURP",
    "KIF2C",
    "NEK2",
    "PLD5",
    "PTTG1",
    "SGO1",
    "UBE2T",
    "LINC01055",
    "CACNA1D",
    "WWOX",
    "TRPC7",
    "LINGO2",
    "SOBP",
    "SIGLEC11",
    "NTNG1",
    "APOH",
    "CHMP4C",
    "GRIN2B",
    "SCN2A",
    "ALDH1A1",
    "ATP11A",
    "CTTNBP2",
    "FANCD2",
    "GALNTL6",
    "MAP3K13",
    "NRXN2",
    "CNGA1",
    "CPLX4",
    "CRABP2",
    "GDPD5",
    "IMPG2",
    "INHBB",
    "KCNB1",
    "KCNN3",
    "LINC00457",
    "MYO3B",
    "SAMD12",
    "NLRP12",
    "CPM",
    "ST6GAL2",
    "CDCA4",
    "CKAP5",
    "HIST1H4C",
    "HUNK",
    "SORBS1",
    "ST8SIA1",
    "WDR76",
    "DTL",
    "FANCC",
    "HIST1H1D",
    "SAE1",
    "SPSB4",
    "WDR62",
    "CEP192",
    "P2RX1",
    "SYT7",
    "CALN1",
    "DLGAP1",
    "ABCA7",
    "CDH18",
    "CHRM3",
    "CNTNAP5",
    "DNM3",
    "DUSP1",
    "LAMA3",
    "LHFPL3",
    "LRFN2",
    "MLLT3",
    "OSBP2",
    "PCSK5",
    "PDGFC",
    "SNAP91",
    "ARC",
    "CEP55",
    "VRK1",
    "ADAMTS17",
    "ANO4",
    "CACNG7",
    "CSGALNACT1",
    "GALNT14",
    "CDK14",
    "PCNX2",
    "RBFOX1",
    "RTN1",
    "SGK1",
    "SLC44A5",
    "PPP1R27",
    "MEG3",
    "TLL1",
    "CSMD3",
    "ZPBP",
    "ELMO1",
    "GRM5",
    "LIN7A",
    "LRRC7",
    "NTRK3",
    "PDZRN4",
    "UNC5D",
    "WSCD2",
    "ZC3HAV1",
    "AOC1",
    "C11orf91",
    "MFSD4A",
    "BARD1",
    "BLM",
    "CDK1",
    "ANP32E",
    "ARHGAP19",
    "MMS22L",
    "CDH12",
    "FAM160A1",
    "GTSE1",
    "RNF150",
    "TMTC1",
    "SEMA3C",
    "ACOT11",
    "COLEC12",
    "CPLX3",
    "GABRA5",
    "KLHL3",
    "MICAL3",
    "RRH",
    "KCND3",
    "MAMDC2",
    "REV3L",
    "RPS2",
    "MYRIP",
    "SLC4A5",
    "ABCC8",
    "LDB2",
    "MCF2L2",
    "PLCB4",
    "RAB3C",
    "ABCB11",
    "DOCK3",
    "FBXL17",
    "RGS8",
    "ST7",
    "RPL13A",
    "CAMK1D",
    "GRM8",
    "KCNIP4",
    "PID1",
    "PRKCE",
    "SLC7A8",
    "ADD3",
    "FBLN1",
    "LYST",
    "TRIM59",
    "VIM",
    "GRIK4",
    "FRZB",
    "ZPLD1",
    "CSRP3",
    "GABRR1",
    "GPR179",
    "HOOK1",
    "LRRC1",
    "MIR99AHG",
    "STARD13",
    "VGLL3",
    "CLMN",
    "KIF5C",
    "NEGR1",
    "SKAP2",
    "CAMK2B",
    "RABGAP1L",
    "REEP1",
    "UNC119",
    "LINC01348",
    "LINC00877",
    "NYAP2",
    "TPD52",
    "KCNC2",
    "PAUPAR",
    "SIRPB1",
    "CGN",
    "ARHGAP26",
    "GRIP1",
    "DLGAP2",
    "FUT7",
    "HSPB7",
    "SLC25A47",
    "CRIM1",
    "ABCC3",
    "ASXL3",
    "CPEB3",
    "KCTD8",
    "MIR124-2HG",
    "SFMBT2",
    "FMN2",
    "HCN1",
    "MOK",
    "OXR1",
    "PSKH2",
    "SCN3B",
    "SLC38A1",
    "UNC80",
    "PROX1-AS1",
    "CNTN3",
    "LINC00951",
    "LRBA",
    "WDHD1",
    "ROR1",
    "CLRN2",
    "GINS1",
    "CABP1",
    "ZP2",
    "PLEKHG6",
    "PLEKHA5",
    "RGS7",
    "SLC5A5",
    "GAREM1",
    "AC011306.1",
    "MTSS1",
    "CYP7B1",
    "MPP7",
    "PLCB1",
    "KIAA1211L",
    "AC141930.2",
    "MIR3663HG",
    "HECW2",
    "CUBN",
    "DMRTB1",
    "PRKG1",
    "CAMK2D",
    "PTCH1",
    "LINC00690",
    "SPTBN1",
    "BTRC",
    "LINC00838",
    "CDC42BPG",
    "TEX33",
    "ANKRD60",
    "FHIT",
    "NEDD9",
    "CCDC18",
    "BCAS3",
    "FGD4",
    "NELL2",
    "TRH",
    "BOC",
    "SUSD4",
    "MAK",
    "QDPR",
    "ARL6",
    "FABP7",
    "GNGT2",
    "LRCH1",
    "ADCY2",
    "EEF2K",
    "GATB",
    "PYGL",
    "SGO2",
    "TMTC2",
    "KCNMB2",
    "LMNTD1",
    "ESPL1",
    "PDE11A",
    "FRAS1",
    "MTUS1",
    "MYOM3",
    "RAB17",
    "TTK",
    "TRIM9",
    "FBXL7",
    "PDE6B",
    "EEPD1",
    "LAMA1",
    "APCDD1L",
    "MAN1A1",
    "PIK3R3",
    "GDF15",
    "SLC6A5",
    "DLEU1",
    "FAM184B",
    "PCDH15",
    "TGFB2",
    "CHIT1",
    "RALGPS2",
    "PTPRO",
    "TSPAN18",
    "NKAIN3",
    "POU2F3",
    "PGC",
    "HHATL",
    "GOLT1A",
    "SPEM1",
    "ASGR2",
    "MMP26",
]
adata_rna = adata_rna[
    :,
    [x for x in adata_rna.var.index if x in genes],
]

adata_atac = scv.read(adata_atac_file)

shared_cells = pd.Index(np.intersect1d(adata_rna.obs_names, adata_atac.obs_names))
shared_genes = pd.Index(np.intersect1d(adata_rna.var_names, adata_atac.var_names))
len(shared_cells), len(shared_genes)
adata_rna = adata_rna[shared_cells, shared_genes]
adata_atac = adata_atac[shared_cells, shared_genes]

scv.pp.normalize_per_cell(adata_rna)
scv.pp.log1p(adata_rna)
scv.pp.moments(adata_rna, n_pcs=30, n_neighbors=50)

print(adata_rna)
print(adata_atac)

sc.pl.umap(adata_rna, color="majorclass")


adata_result = mv.recover_dynamics_chrom(
    adata_rna,
    adata_atac,
    max_iter=5,
    init_mode="invert",
    verbose=False,
    parallel=True,
    save_plot=False,
    rna_only=False,
    fit=True,
    n_anchors=500,
    extra_color_key="majorclass",
    n_jobs=10,
)
adata_result.write(output_file)